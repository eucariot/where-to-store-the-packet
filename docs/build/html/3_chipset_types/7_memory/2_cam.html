

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="ru" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ru" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>CAM - Content-Addressable Memory &mdash; документация Где сохранить пакет? 1.0</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Алфавитный указатель" href="../../genindex.html" />
    <link rel="search" title="Поиск" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Где сохранить пакет?
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">CAM - Content-Addressable Memory</a></li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Где сохранить пакет?</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>CAM - Content-Addressable Memory</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/3_chipset_types/7_memory/2_cam.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cam-content-addressable-memory">
<h1>CAM - Content-Addressable Memory<a class="headerlink" href="#cam-content-addressable-memory" title="Ссылка на этот заголовок">¶</a></h1>
<div class="line-block">
<div class="line">Это особо-хитрый вид памяти.</div>
<div class="line">Вы ей - значение, а она вам - адрес ячейки.</div>
<div class="line">Content-Addressable означает, что адресация базируется на значениях (содержимом).</div>
</div>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="https://habrastorage.org/webt/x2/fu/c-/x2fuc-9boi2-rn_p-kw4lfpdfh4.png"><img alt="https://habrastorage.org/webt/x2/fu/c-/x2fuc-9boi2-rn_p-kw4lfpdfh4.png" src="https://habrastorage.org/webt/x2/fu/c-/x2fuc-9boi2-rn_p-kw4lfpdfh4.png" style="width: 700px;" /></a>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">Значением, например, может быть, например DMAC. CAM прогоняет DMAC по всем своим записям и находит совпадение. В результате CAM выдаст адрес ячейки в классической RAM, где хранится номер выходного интерфейса. Дальше устройство обращается к этой ячейке и отправляет кадр, куда положено.</div>
<div class="line">Для достижения максимальной скорости CAM и RAM располагаются очень близко друг к другу.</div>
</div>
<blockquote>
<div><p>Не путать данную RAM с RAM, содержащей Soft Tables, описанной выше - это разные компоненты, расположенные в разных местах.</p>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="https://habrastorage.org/webt/1x/bn/3z/1xbn3zn1xmjlpupsf6k6guwtlwm.png"><img alt="https://habrastorage.org/webt/1x/bn/3z/1xbn3zn1xmjlpupsf6k6guwtlwm.png" src="https://habrastorage.org/webt/1x/bn/3z/1xbn3zn1xmjlpupsf6k6guwtlwm.png" style="width: 1000px;" /></a>
</div>
</div></blockquote>
</div></blockquote>
<div class="line-block">
<div class="line">Прелесть CAM в том, что она возвращает результат за фиксированное время, не зависящее от количества и размера записей в таблице - О(1), выражаясь в терминах сложностей алгоритмов.</div>
<div class="line">Достигается это за счёт того, что значение сравнивается <strong>одновременно</strong> со всеми записями. Одновременно! А не перебором.</div>
</div>
<div class="line-block">
<div class="line">На входе каждой ячейки хранения в CAM стоят сравнивающие элементы (мне очень нравится термин компараторы), которые могут выдавать 0 (разомкнуто) или 1 (замкнуто) в зависимости от того, что на них поступило и что записано.</div>
<div class="line">В сравнивающих элементах записаны как раз искомые значения.</div>
<div class="line">Когда нужно найти запись в таблице, соответствующую определённому значению, это значение прогоняется одновременно через ВСЕ сравнивающие элементы. Буквально, электрический импульс, несущий значения, попадает на все элементы, благодаря тому, что они подключены параллельно. Каждый из них выполняет очень простое действие, выдавая для каждого бита 1, если биты совпали, и 0, если нет, то есть замыкая и размыкая контакт. Таким образом та ячейка, адресом которой является искомое значение, замыкает всю цепь, электрический сигнал проходит и запитывает её.</div>
</div>
<p>Вот архитектура такой памяти:</p>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="https://ars.els-cdn.com/content/image/1-s2.0-S0141933113001348-gr1.jpg"><img alt="https://ars.els-cdn.com/content/image/1-s2.0-S0141933113001348-gr1.jpg" src="https://ars.els-cdn.com/content/image/1-s2.0-S0141933113001348-gr1.jpg" style="width: 700px;" /></a>
<div class="legend">
<p><a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0141933113001348">Источник</a>.</p>
</div>
</div>
</div></blockquote>
<p>Вот пример работы</p>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="http://www.eecg.toronto.edu/~roman/teaching/1388/2004/finalProj/2004_ECE1388_FP_www/LRU_Cache/vlsi_final_report_v4_files/image076.jpg"><img alt="http://www.eecg.toronto.edu/~roman/teaching/1388/2004/finalProj/2004_ECE1388_FP_www/LRU_Cache/vlsi_final_report_v4_files/image076.jpg" src="http://www.eecg.toronto.edu/~roman/teaching/1388/2004/finalProj/2004_ECE1388_FP_www/LRU_Cache/vlsi_final_report_v4_files/image076.jpg" style="width: 700px;" /></a>
<div class="legend">
<p><a class="reference external" href="http://www.eecg.toronto.edu/~roman/teaching/1388/2004/finalProj/2004_ECE1388_FP_www/LRU_Cache/">Источник</a>.</p>
</div>
</div>
</div></blockquote>
<dl>
<dt>А это схема реализации:</dt><dd><div class="figure align-center">
<a class="reference internal image-reference" href="https://www.pagiamtzis.com/cam/images/bcam.png&quot;&gt;"><img alt="https://www.pagiamtzis.com/cam/images/bcam.png&quot;&gt;" src="https://www.pagiamtzis.com/cam/images/bcam.png&quot;&gt;" style="width: 700px;" /></a>
<div class="legend">
<p><a class="reference external" href="https://www.pagiamtzis.com/cam/camintro/">Источник</a>.</p>
</div>
</div>
</dd>
</dl>
<p>Это чем-то похоже на пару ключ-замок. Только ключ с правильной геометрией может поставить штифты замка в правильные положения и провернуть цилиндр.
Вот только у нас много копий одного ключа и много разных конфигураций замков. И мы вставляем их все одновременно и пытаемся провернуть, а нужное значение лежит за той дверью, замок которой ключ откроет.</p>
<p>Для гибкого использования CAM мы берём не непосредственно значения из полей заголовков, а вычисляем их хэш.
Хэш-функция используется для следующих целей:</p>
<blockquote>
<div><p>#. Длина результата значительно меньше, чем у входных значений. Так пространство MAC-адресов длиной 48 бит можно отобразить в 16-ибитовое значение, тем самым в 2^32 раза уменьшив длину значений, которые нужно сравнивать, и соответственно, размер CAM.
Основная идея хэш-функции в том, что результат её выполнения для одинаковых входных данных всегда будет одинаков (например, как остаток от деления одного числа на другое - это пример элементарной хэш функции).
#. Результат её выполнения на всём пространстве входных значений - это ± плоскость - все значения равновероятны. Это важно для снижения вероятности конфликта хэшей, когда два значения дают одинаковый результат.
Конфликт хэшей, кстати, весьма любопытная проблема, которая описана в <a class="reference external" href="https://ru.wikipedia.org/wiki/Парадокс_дней_рождения">парадоксе дней рождения</a>. Рекомендую почитать <a class="reference external" href="https://www.juniper.net/uk/en/training/jnbooks/distinguished-engineering/hardware-defined-networking/">Hardware Defined Networking</a> Брайна Петерсена, где помимо всего прочего он описывает механизмы избежания конфликта хэшей.
#. Независимо от длины исходных аргументов, результат будет всегда одной длины. То есть на вход можно подать сложное сочетание аргументов, например, DMAC+EtherType, и для хранения не потребуется выделять более сложную структуру памяти.</p>
</div></blockquote>
<p>Именно хэш закодирован в сравнивающие элементы. Именно хэш искомого значения будет сравниваться с ними.
По принципу CAM схож с хэш-таблицами в программировании, только реализованными на чипах.</p>
<p>В этот принцип отлично укладывается также MPLS-коммутация, почему MPLS и сватали в своё время на IP.</p>
<p>Например:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Пришёл самый первый Ethernet-кадр на порт коммутатора.</p></li>
<li><p>Коммутатор извлёк ` &lt;<a class="reference external" href="http://lookmeup.linkmeup.ru/#term605">http://lookmeup.linkmeup.ru/#term605</a>»&gt;SMAC&gt;`_, вычислил его хэш.</p></li>
<li><p>Данный хэш он записал в сравнивающие элементы CAM, номер интерфейса откуда пришёл кадр в RAM, а в саму ячейку CAM адрес ячейки в RAM.</p></li>
<li><p>Выполнил рассылку изначального кадра во все порты.</p></li>
<li><p>Повторил пп. 1-5 ….</p></li>
<li><p>Заполнена вся таблица MAC-адресов.</p></li>
<li><p>Приходит Ethernet-кадр. Коммутатор сначала проверяет, известен ли ему данный <a class="reference external" href="http://lookmeup.linkmeup.ru/#term605">SMAC</a> (сравнивает хэш адреса с записанными хэшами в CAM) и, если нет, сохраняет.</p></li>
<li><p>Извлекает <a class="reference external" href="http://lookmeup.linkmeup.ru/#term606">DMAC</a>, считает его хэш.</p></li>
<li><p>Данный хэш он прогоняет через все сравнивающие элементы CAM и находит единственное совпадение.</p></li>
<li><p>Узнаёт номер порта, отправляет туда изначальный  кадр.</p></li>
</ol>
</div></blockquote>
<p><strong>Резюме:</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>Ячейки CAM адресуются хэшами.</p></li>
<li><p>Ячейки CAM содержат (обычно) адрес ячейки в обычной памяти (RAM), потому что хранить конечную информацию - дорого.</p></li>
<li><p>Каждая ячейка CAM имеет на входе сравнивающий элемент, который сравнивает искомое значение с хэш-адресом. От этого размер и стоимость CAM значительно больше, чем RAM.</p></li>
<li><p>Проверка совпадения происходит <strong>одновременно</strong> во всех записях, отчего CAM дюже греется, зато выдаёт результат за константное время.</p></li>
<li><p>CAM+RAM хранят <strong>Hard Tables</strong> (аппаратные таблицы), к которым обращается чип коммутации.</p></li>
</ul>
</div></blockquote>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, eucariot

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>