SerDes
======

Если коротко - то это блоки (`IP-core <https://ru.wikipedia.org/wiki/IP-cores>`_) сетевого ASIC'а, которые позволяют получить сигнал с пинов и, наоборот, передать его туда.

Теперь с этимологией. Аналогично "модему" и "кодеку", ставшим уже такими родными в кириллическом написании, SerDes составлен из двух слов: **Serializer-Deserializer**. Так чего же он сериализует и десериализует?

| Всё дело в скорости работы сетевых чипов. Независимо от их типа (ASIC, NP, CPU) - их частота находится в пределах сотен Мгц - единиц Ггц. А частота передачи данных с порта 10Гб/с - 10 Ггц (100 Гбит/с = 4х25ГГц). Соответственно, каким-то образом нужно понизить частоту внутри чипа. И как раз это достигается тем, что сигнал из пары вводных пинов распараллеливается на множество внутренних линий - десериализуется.
| В обратную сторону - сигнал с нескольких линий нужно сериализовать в пару пинов.

Блоки SerDes всегда являются составными частями кристалла сетевого чипа.

    .. figure:: https://fs.linkmeup.ru/images/articles/buffers/serdeses.jpg           
           :width: 400
           :align: center

           ..

           `Источник <https://www.design-reuse.com/news/44362/esilicon-7nm-ip-networking-platform.html>`_

    .. figure:: https://fs.linkmeup.ru/images/articles/buffers/serdes_inside.png           
           :width: 500
           :align: center

           ..

           `Источник <http://www.trex.fi/2017/Ralf-Korschner-The-March-of-Merchant-Silicon.pdf>`_

| Один SerDes - это 4 пина на пузике асика - два для Tx, два для Rx.
| Скорость одного SerDes'а - величина скачкообразно растущая с годами . Наиболее распространённые сегодня - это 10Гб/с и 28Гб/с. Но в скором будущем датацентровый масс-маркет начнут заполонять устройства с 56Гб/с SerDes и даже со 112Гб/с.

Выглядит довольно сложным. Для чего же вообще устраивать эту сериальную вакханалию, а не сделать просто пинов по числу реальных линий в чипе?

Зачем?
------

| Ну, давайте прикинем, спайн-коммутатор с 64х100Гб/с портами несёт под кожухом ASIC ёмкостью 6,4 Тб/с.
| Если каждые 4 пина чипа могут обеспечить 28Гб/с в полном дуплексе, значит, на нём должно быть 64*4*4=1024 пинов.
| Это уже как минимум 32х32 пинов на 40 см^2, не считая питания и земли. И они там сидят довольно плотненько. Легко ли будет кратно нарастить их количество?

| Однако проблема не только и не столько с количеством пинов.
| Тенденция к серийным интерфейсам намечается `уже давно <https://www.design-reuse.com/articles/10541/multi-gigabit-serdes-the-cornerstone-of-high-speed-serial-interconnects.html>`_.
| На смену переферийным параллельным портам пришли серийные (USB на смену параллельному)

| На смену IDE - SATA (Serial ATA)
| На смену SCSI - SAS (Serial SCSI)
| На смену PCI - PCI Express

| Это жжж неспроста. Ведь казалось бы, чем больше проводов, тем больше данных можно передать за единицу времени?
| На самом деле нет - при параллельной передаче с повышением скорости всё острее и острее встают вопросы синхронизации между этими самым проводами. Схемотехники даже связанные дорожки на платах `проектируют так <https://linkmeup.ru/blog/401.html#DIFFPAIRS>`_, чтобы они были максимально одинаковой длины.
| В какой-то момент задача усложнилась настолько, что дальнейшее развитие пошло по увеличению полосы пропускания обычной дифф-пары вместо параллелизма. В частности для 100Гб/с другого варианта просто не существует. 

Модуляция
---------

| То, каким образом множество параллельных сигналов укладывается в один, зависит от метода модуляции.
| Для SerDes с пропускной сопособностью 10Гб/с и 28Гб/с используется **NRZ** - `Non-Return-to-Zero <https://en.wikipedia.org/wiki/Non-return-to-zero>`_. 
| С ним же `добились <https://www.nextplatform.com/micro-site-content/taking-closer-look-rambus-56-gbps-multi-protocol-serdes-phy/>`_ и 56Гб/с. Но всё же стандартом *de facto* для 56Гб/с и *de iure* для 112Гб/с является **PAM4** - `4 -level Pulse Amplitude Modulation <https://blogs.cisco.com/sp/pam4-for-400g-optical-interfaces-and-beyond-part-1>`_.
| Есть и `ленивые пессимистичные взгляды <http://www.ieee802.org/3/ad_hoc/ngrates/public/17_05/sun_nea_01a_0517.pdf>`_ в сторону PAM8.

Итого, учитывая современные реалии (NRZ), для того, чтобы запитать данными интерфейс 100Гб/с нужно подвести к нему 4 SerDes'а по 28Гб/с (или 16 дорожек). Отсюда и берётся "лейновость" 100Ж-портов: 4 лейна - это 4 канала по 28Гб/с.

И это то, что позволяет 1х100Ж порт разбить на 4х25Ж с помощью гидры.

    .. figure:: https://fs.linkmeup.ru/images/articles/buffers/breakout.png           
           :width: 500
           :align: center

В случае PAM4 для 100Ж нужно только 2 SerDes'а по 56Гб/с, то есть два лейна.

GearBox'ы
---------

Сложности с переходом на новые методы модуляции заключаются в том, что устройства на разных сторонах должны использовать одинаковые, либо нужно ставить дополнительные конвертеры. То есть просто подключить сотками коммутатор с PAM4 к NRZ не получится.

| Но когда индустрия бросала своих участников, не предлагая им решений? Для того, чтобы устройства с разными модуляциями могли взаимодействовать друг с другом, изобрели коробки передач, которые из малого количество высокоскоростных линий делают много помедленнее и наоборот.
| Так, в новейшие коммутаторы, выпускаемые сегодня, `ставят дополнительные чипы <https://www.marketwatch.com/press-release/broadcoms-industry-leading-pam-4-phy-shipments-surpass-1-million-ports-2018-09-20>`_, чтобы их можно было использовать в сети с более старым оборудованием.

| Использование гирбоксов также упростит вендорам и переход на 400G - не придётся менять ASIC - достаточно заменить/убрать гирбокс.