Интерфейсный модуль или линейная карта
======================================

Это модуль, который несёт на себе физические интерфейсы и FE (чип коммутации) и выполняет функции Forwarding Plane

| По большому счёту линейнкая карта модульного коммутатора - это тот же самый стоечный коммутатор только в форм-факторе платы.
| Кроме интерфейсов и чипа коммутации в нём так же есть и CPU, и память, и блоки TM итд. Просто вместо обычных аплинков у неё коннекторы в общую шину, ведущие в другие платы, и ещё ей нужно общаться с управляющей платой, чтобы синхронизировать своё состояние.
| Поскольку вся книга посвящена устройству коммутаторов, сильно акцентироваться я в этом месте не буду.

    .. figure:: https://fs.linkmeup.ru/images/articles/buffers/linecard.png          
           :width: 700
           :align: center

Так выглядит линейная карта Cisco:

    .. figure:: https://habrastorage.org/webt/j0/k7/6q/j0k76qe4foc99appxtoy89qjd58.jpeg           
           :width: 800
           :align: center

Плата состоит из многих компонентов, которые могут быть реализованы как в одном чипе (System-on-Chip), так и на множестве отдельных в зависимости от класса устройства и архитектуры.

    .. figure:: https://habrastorage.org/webt/bd/da/lk/bddalkqpkl8dsebhhonu3j59ixe.png           
           :width: 1000
           :align: center

Основные части линейной карты:
  
  * Собственно интерфейс
  * PHY
  * MAC
  * FE - Forwardin Engine (Ingress/Egress)
  * TM - Traffic Manager (QoS)
  * Fabric Interface

Иногда часть этих компонентов может выноситься на отдельный извлекаемый модуль - **PIC** (Physical Interface Card). Например, на нём могут быть интерфейсы, PHY и MAC.

    .. figure:: https://habrastorage.org/webt/jz/az/rm/jzazrm1xllwfzby4hyhuq5spgjg.jpeg           
         :width: 800
         :align: center

         Так выглядит Juniper MIC (Modular Interface Card), совмещённый с чипом PIC

    .. figure:: https://fs.linkmeup.ru/images/articles/buffers/linecard_details.png          
         :width: 800
         :align: center


Интерфейс
---------

Электрический/оптический любого форм-фактора.
Реализует возможность подключения провода в устройство через стандартный тип порта.

PHY
---

PHY занимается задачами физического уровня:

    * Конвертация сигнала между средами (оптика-медь), если это нужно
    * Восстановление битов из сигналов и наоборот
    * Коррекция ошибок
    * Синхронизация

Если интерфейс обычный медный, интегрированный, то чип PHY находится на плате и металлическимм дорожками соединён с самим интерфейсом.
Если же интерфейс предполагает использование трансивера, то чип PHY обычно находится уже на этом трансивере.

MAC
---

Модуль MAC выполняет задачи канального уровня - Ethernet. Чаще всего является частью FE, но не всегда.

FE - Forwarding Engine
----------------------

FE реализует все функции, связанные с коммутацией и маршрутизацией:

    * Запросы к CAM/TCAM
    * Трансформация Soft Table в Hard Table
    * Принятие решения о передаче пакета (ACL, полисинг)
    * Коммутация/Маршрутизация
    * Маркировка приоритетов
    * Зеркалирование
    * Обнаружение протокольных пакетов
    * Обработка сигналов/пакетов от CPU.

Далее **ВНИМАНИЕ**! Это один из очень важных моментов!

| Во-первых, FE делится на **Ingress FE** и **Egress FE**. Первый обрабатывает соответственно пакеты на входном тракте, второй - на выходном.
| С одной стороны это разделение терминологическое - пакет пришёл на Ingress FE и далее должен быть отправлен на Egress FE, возможно, другой платы.
| С другой, разделение - зачастую вполне физическое: внутри одного FE чипа живут эти две сущности: Ingress и Egress. Это и логично - ведь плата может быть как точкой входа, так и точкой выхода.
| Во-вторых, именно входной FE входной линейной карты определяет всю дальнейшую судьбу пакета в пределах узла:

  * Вид будущих заголовков
  * Приоритет внутри узла и при передаче вовне
  * Выходной FE и интерфейс
  * Какой именно из физических членов `LAG <http://lookmeup.linkmeup.ru/#term443>`_ или `ECMP <https://linkmeup.ru/blog/482.html>`_

*с небольшой оговоркой, что выходной тракт всё-таки может ещё произвести репликацию пакета или зарезать его по ACL*

В-третьих, FE должен идентифицировать протокольные и исключительные пакеты в транзитном трафике и передавать их на CPU.
Соответственно и получать пакеты (или инструкции) от CPU - тоже его работа.

Рядом с FE находятся CAM, TCAM и RAM, куда FE обращается в поиске выходного интерфейса и проверки ACL.
Они хранят Hard Tables.

Кроме того Ingress FE производит репликацию BUM трафика - он рассылает по одной копии пакета на каждый Egress FE. А Egress FE уже делает столько копий, во сколько интерфейсов нужно отправить

QoS или TM - Traffic Manager
----------------------------

В одночиповых коммутаторах TM обычно является частью чипа коммутации, в модульных может стоять отдельно.
Управлению трафиком, памяти и буферам посвящена львиная часть этой книги, поэтому здесь коснусь этого только вскользь.

Задача TM - выделять очереди, следить за перегрузками и рапоряжаться трафиком таким образом, как того требует дизайн QoS и маркировка пакетов (Congestion Avoidance и Congestion Management). Он же занимается репликацией BUM-трафика.

Fabric Interface
----------------

Чип, который обеспечивает взаимодействие с фабрикой коммутации. Может быть как частью FE, так и самостоятельным.
Зачастую трафик на фабрику отправляется не как есть, а разбивается на ячейки одинакого размера, чтобы максимально равномерно загрузить все существующие линии. Это, а также передача метаданных - задача данного чипа. 